<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weight Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg);
      color: var(--text);
      transition: all 0.3s;
    }
    :root {
      --bg: #ffffff;
      --text: #111827;
      --card: #f9fafb;
    }
    [data-theme="dark"] {
      --bg: #111827;
      --text: #f9fafb;
      --card: #1f2937;
    }
    .container {
      max-width: 700px;
      margin: auto;
      padding: 2rem;
    }
    .card {
      background-color: var(--card);
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 1.5rem;
    }
    h1, h2, h3 {
      margin-top: 0;
    }
    .flex {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    button, input {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
    }
    .progress {
      height: 20px;
      background-color: #ddd;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: #10b981;
      width: 0;
      transition: width 0.6s;
    }
    .quote {
      font-style: italic;
      text-align: center;
      margin-bottom: 1rem;
    }
    .dark-toggle {
      cursor: pointer;
      font-size: 0.9rem;
      color: var(--text);
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="dark-toggle"><button onclick="toggleTheme()">ðŸŒ“ Toggle Theme</button></div>
    <h1>Weight Tracker</h1>
    <div class="quote" id="motivation"></div>

    <div class="card">
      <form onsubmit="saveWeight(event)">
        <label for="weight">Enter your weight (kg):</label><br />
        <input type="number" id="weight" step="0.1" required />
        <button type="submit">Submit</button>
      </form>
    </div>

    <div class="card">
      <h3>Progress</h3>
      <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
      <p><strong>BMI:</strong> <span id="bmi">-</span></p>
      <p><strong>TDEE (food allowance):</strong> <span id="tdee">-</span> kcal/day</p>
      <p><strong>Est. burn to lose 0.5kg/week:</strong> <span id="burn">-</span> kcal/day</p>
      <p><strong>Est. days to goal:</strong> <span id="daysToGoal">-</span></p>
      <p><strong>Recommended sleep:</strong> 8â€“10 hours/night</p>
    </div>

    <div class="card">
      <h3>Chart</h3>
      <canvas id="weightChart" height="100"></canvas>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDCANiNTmv4bU7ayVyCD_Dwwf04QQ7XlVc",
      authDomain: "weight-tracker-01.firebaseapp.com",
      databaseURL: "https://weight-tracker-01-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "weight-tracker-01",
      storageBucket: "weight-tracker-01.appspot.com",
      messagingSenderId: "560173087855",
      appId: "1:560173087855:web:d6b591b55e6151ac7c619a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const weightRef = ref(db, "weights");

    const age = 15, height = 155, goalWeight = 48, startWeight = 53;
    const motivationList = [
      "Keep going, you're doing great!",
      "Every step counts.",
      "Progress, not perfection.",
      "Discipline beats motivation.",
      "Small changes lead to big results.",
      "Youâ€™ve got this!",
      "Sweat is fat crying.",
      "Stay focused and never give up."
    ];

    document.getElementById("motivation").textContent = motivationList[Math.floor(Math.random() * motivationList.length)];

    window.toggleTheme = function () {
      const theme = document.documentElement.getAttribute("data-theme") === "dark" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem("theme", theme);
    };

    if (localStorage.getItem("theme")) {
      document.documentElement.setAttribute("data-theme", localStorage.getItem("theme"));
    }

    let chart;
    function updateChart(data) {
      const labels = data.map(d => new Date(d.date).toLocaleDateString());
      const weights = data.map(d => d.weight);
      if (chart) chart.destroy();
      chart = new Chart(document.getElementById("weightChart"), {
        type: 'line',
        data: {
          labels,
          datasets: [{ label: 'Weight (kg)', data: weights, fill: false, borderColor: '#3b82f6' }]
        }
      });
    }

    onValue(weightRef, (snapshot) => {
      const values = snapshot.exists() ? Object.values(snapshot.val()) : [];
      values.sort((a, b) => a.date - b.date);
      if (values.length) {
        const latest = values[values.length - 1];
        const bmi = (latest.weight / ((height / 100) ** 2)).toFixed(1);
        const bmr = Math.round(10 * latest.weight + 6.25 * height - 5 * age + 5);
        const tdee = Math.round(bmr * 1.5); // moderate active
        const burnTarget = Math.round(500); // 0.5kg/week deficit
        const daysToGoal = Math.max(0, Math.round((latest.weight - goalWeight) * 7700 / 500));
        const progress = Math.min(100, ((startWeight - latest.weight) / (startWeight - goalWeight)) * 100);

        document.getElementById("bmi").textContent = bmi;
        document.getElementById("tdee").textContent = tdee;
        document.getElementById("burn").textContent = burnTarget;
        document.getElementById("daysToGoal").textContent = daysToGoal;
        document.getElementById("progressBar").style.width = progress + "%";

        updateChart(values);
      }
    });

    window.saveWeight = function (e) {
      e.preventDefault();
      const weight = parseFloat(document.getElementById("weight").value);
      if (!isNaN(weight)) {
        push(weightRef, { weight, date: Date.now() });
        document.getElementById("weight").value = "";
      }
    };
  </script>
</body>
</html>
