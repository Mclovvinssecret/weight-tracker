<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weight Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 2rem;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    :root {
      --bg: #ffffff;
      --text: #000000;
    }
    .dark-mode {
      --bg: #121212;
      --text: #f1f1f1;
    }
    input, button {
      padding: 0.5rem;
      margin: 0.5rem 0;
    }
    .container {
      max-width: 500px;
      margin: auto;
    }
    .progress-bar {
      background: #ddd;
      border-radius: 10px;
      overflow: hidden;
      height: 20px;
      margin-bottom: 1rem;
    }
    .progress-bar-fill {
      height: 100%;
      background: #4caf50;
      width: 0%;
      transition: width 0.3s;
    }
  </style>
</head>
<body>
<div class="container">
  <button onclick="toggleMode()">Toggle Light/Dark</button>
  <h1>Weight Tracker</h1>
  <div id="inputForm">
    <label>Age: <input type="number" id="age" /></label><br />
    <label>Height (cm): <input type="number" id="height" /></label><br />
    <label>Start Weight (kg): <input type="number" id="startWeight" /></label><br />
    <label>Goal Weight (kg): <input type="number" id="goalWeight" /></label><br />
    <button onclick="initializeUser()">Start Tracking</button>
  </div>

  <div id="tracker" style="display:none">
    <label>Latest Weight (kg): <input type="number" id="latestWeight" /></label>
    <button onclick="submitWeight()">Submit</button>

    <canvas id="weightChart" width="400" height="200"></canvas>
    <div class="progress-bar"><div id="progressFill" class="progress-bar-fill"></div></div>

    <p><strong>Progress:</strong> <span id="progressText">0%</span></p>
    <p><strong>BMI:</strong> <span id="bmi"></span></p>
    <p><strong>Calories/day (TDEE):</strong> <span id="tdee"></span> kcal</p>
    <p><strong>Est. Burn Needed:</strong> 500 kcal/day</p>
    <p><strong>Est. Days to Goal:</strong> <span id="estDays"></span></p>
    <p><strong>Recommended Sleep:</strong> 8â€“10 hours</p>
    <p id="motivation"></p>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDCANiNTmv4bU7ayVyCD_Dwwf04QQ7XlVc",
    authDomain: "weight-tracker-01.firebaseapp.com",
    databaseURL: "https://weight-tracker-01-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "weight-tracker-01",
    storageBucket: "weight-tracker-01.appspot.com",
    messagingSenderId: "560173087855",
    appId: "1:560173087855:web:d6b591b55e6151ac7c619a",
    measurementId: "G-E4MRDK2VZE"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let userInfo = {};
  let weights = [];
  let chart;

  function toggleMode() {
    document.body.classList.toggle('dark-mode');
  }

  function initializeUser() {
    userInfo.age = parseInt(document.getElementById('age').value);
    userInfo.height = parseFloat(document.getElementById('height').value);
    userInfo.startWeight = parseFloat(document.getElementById('startWeight').value);
    userInfo.goalWeight = parseFloat(document.getElementById('goalWeight').value);

    if (!userInfo.age || !userInfo.height || !userInfo.startWeight || !userInfo.goalWeight) return alert("Fill all fields");

    set(ref(db, 'userInfo'), userInfo);
    document.getElementById('inputForm').style.display = 'none';
    document.getElementById('tracker').style.display = 'block';

    renderChart();
    updateMetrics(userInfo.startWeight);
    loadMotivation();
  }

  function submitWeight() {
    const latest = parseFloat(document.getElementById('latestWeight').value);
    if (!latest || !userInfo.height || !userInfo.age) return alert("Missing data");

    const weightRef = push(ref(db, 'weights'));
    set(weightRef, { value: latest, time: Date.now() });

    weights.push(latest);
    updateChart();
    updateMetrics(latest);
  }

  function renderChart() {
    const ctx = document.getElementById('weightChart').getContext('2d');
    chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Weight (kg)',
          data: [],
          borderColor: '#4caf50',
          tension: 0.3
        }]
      }
    });
  }

  function updateChart() {
    chart.data.labels = weights.map((_, i) => `Day ${i + 1}`);
    chart.data.datasets[0].data = weights;
    chart.update();
  }

  function updateMetrics(currentWeight) {
    const h = userInfo.height / 100;
    const bmi = currentWeight / (h * h);
    document.getElementById('bmi').textContent = bmi.toFixed(1);

    const bmr = 10 * currentWeight + 6.25 * userInfo.height - 5 * userInfo.age + 5;
    const tdee = bmr * 1.55;
    document.getElementById('tdee').textContent = Math.round(tdee);

    const progress = ((userInfo.startWeight - currentWeight) / (userInfo.startWeight - userInfo.goalWeight)) * 100;
    const progressText = Math.min(Math.max(progress, 0), 100).toFixed(0);
    document.getElementById('progressText').textContent = `${progressText}%`;
    document.getElementById('progressFill').style.width = `${progressText}%`;

    const estDays = (currentWeight - userInfo.goalWeight) / 0.5;
    document.getElementById('estDays').textContent = estDays > 0 ? Math.ceil(estDays) + ' days' : 'Goal reached';
  }

  function loadMotivation() {
    const quotes = [
      "Progress, not perfection.",
      "You donâ€™t have to be extreme, just consistent.",
      "Push yourself because no one else is going to do it.",
      "The body achieves what the mind believes.",
      "Discipline is choosing between what you want now and what you want most.",
      "Itâ€™s never too late to be what you might have been.",
      "Small steps every day.",
      "You are your only limit.",
      "Strive for progress, not perfection.",
      "Fall seven times, stand up eight."
    ];
    const quote = quotes[Math.floor(Math.random() * quotes.length)];
    document.getElementById('motivation').textContent = `ðŸ’¬ ${quote}`;
  }
</script>
</body>
</html>
