<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weight Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module">
    // Firebase SDK imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";const firebaseConfig = {
  apiKey: "AIzaSyDCANiNTmv4bU7ayVyCD_Dwwf04QQ7XlVc",
  authDomain: "weight-tracker-01.firebaseapp.com",
  databaseURL: "https://weight-tracker-01-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "weight-tracker-01",
  storageBucket: "weight-tracker-01.appspot.com",
  messagingSenderId: "560173087855",
  appId: "1:560173087855:web:d6b591b55e6151ac7c619a",
  measurementId: "G-E4MRDK2VZE"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let userProfile = JSON.parse(localStorage.getItem('userProfile')) || null;
const weightInput = document.getElementById("weight");
const profileSection = document.getElementById("profile");
const bmiDisplay = document.getElementById("bmi");
const burnDisplay = document.getElementById("burn");
const daysDisplay = document.getElementById("days");
const progressBar = document.getElementById("progress");
const chartCtx = document.getElementById("chart").getContext("2d");

let chart;

function calculateBMI(weight, height) {
  return (weight / ((height / 100) ** 2)).toFixed(1);
}

function calculateCalories(weight, height, age) {
  const bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
  return Math.round(bmr * 1.55);
}

function updateProgress(current, start, goal) {
  const progress = Math.min(100, Math.max(0, ((start - current) / (start - goal)) * 100));
  progressBar.style.width = `${progress}%`;
  progressBar.innerText = `${Math.round(progress)}%`;
}

async function fetchData() {
  const snap = await get(ref(db, "weights"));
  if (snap.exists()) {
    const data = Object.values(snap.val());
    const labels = data.map(e => e.date);
    const weights = data.map(e => e.weight);

    if (weights.length > 0) {
      const latest = weights[weights.length - 1];
      weightInput.value = latest;
      const bmi = calculateBMI(latest, userProfile.height);
      bmiDisplay.innerText = `BMI: ${bmi}`;

      const calories = calculateCalories(latest, userProfile.height, userProfile.age);
      burnDisplay.innerText = `Est. burn to lose: ${calories - 500} kcal/day`;

      const daysLeft = ((latest - userProfile.goal) * 7700) / 500;
      daysDisplay.innerText = `Est. days to goal: ${Math.round(daysLeft)} days`;

      updateProgress(latest, userProfile.start, userProfile.goal);

      if (chart) chart.destroy();
      chart = new Chart(chartCtx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Weight (kg)',
            data: weights,
            borderColor: 'blue',
            fill: false
          }]
        }
      });
    }
  }
}

document.getElementById("submit").onclick = async () => {
  const val = parseFloat(weightInput.value);
  if (!userProfile || isNaN(val)) return;
  const entry = {
    weight: val,
    date: new Date().toISOString().split('T')[0]
  };
  const newRef = push(ref(db, "weights"));
  await set(newRef, entry);
  fetchData();
};

document.getElementById("saveProfile").onclick = () => {
  const age = parseInt(document.getElementById("age").value);
  const height = parseInt(document.getElementById("height").value);
  const start = parseFloat(document.getElementById("start").value);
  const goal = parseFloat(document.getElementById("goal").value);
  if (isNaN(age) || isNaN(height) || isNaN(start) || isNaN(goal)) return;

  userProfile = { age, height, start, goal };
  localStorage.setItem("userProfile", JSON.stringify(userProfile));
  document.getElementById("setup").style.display = "none";
  profileSection.style.display = "block";
  fetchData();
};

window.onload = () => {
  if (!userProfile) {
    document.getElementById("setup").style.display = "block";
    profileSection.style.display = "none";
  } else {
    document.getElementById("setup").style.display = "none";
    profileSection.style.display = "block";
    fetchData();
  }
};

  </script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    .bar { height: 25px; background: #ccc; border-radius: 20px; overflow: hidden; margin: 10px 0; }
    #progress { height: 100%; background: green; text-align: center; color: white; line-height: 25px; }
    input { display: block; margin: 5px 0; width: 100%; padding: 5px; }
    button { margin: 10px 0; padding: 10px; width: 100%; }
  </style>
</head>
<body>
  <h1>Weight Tracker</h1>  <div id="setup" style="display:none">
    <input type="number" id="age" placeholder="Age" />
    <input type="number" id="height" placeholder="Height (cm)" />
    <input type="number" id="start" placeholder="Starting weight (kg)" />
    <input type="number" id="goal" placeholder="Goal weight (kg)" />
    <button id="saveProfile">Save Profile</button>
  </div>  <div id="profile" style="display:none">
    <input type="number" id="weight" placeholder="Enter weight (kg)" />
    <button id="submit">Submit</button><div class="bar"><div id="progress">0%</div></div>
<p id="bmi">BMI: -</p>
<p id="burn">Est. burn to lose: -</p>
<p id="days">Est. days to goal: -</p>
<canvas id="chart" height="200"></canvas>

  </div>
</body>
</html>