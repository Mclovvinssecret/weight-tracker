<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weight Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-white">
  <div class="max-w-xl mx-auto py-10 px-4">
    <h1 class="text-3xl font-bold mb-6 text-center">Weight Tracker</h1><div class="mb-4">
  <input id="weightInput" type="number" placeholder="Enter weight (kg)" class="w-full p-2 border rounded" />
  <button id="submitWeight" class="mt-2 w-full p-2 bg-blue-500 text-white rounded hover:bg-blue-600">Submit</button>
</div>

<canvas id="weightChart" class="mb-6"></canvas>

<div class="w-full bg-gray-300 rounded-full h-4 mb-2">
  <div id="progressBar" class="bg-green-500 h-4 rounded-full" style="width: 0%"></div>
</div>
<div id="progressText" class="text-center mb-2">0%</div>

<div id="bmiText" class="mb-1">BMI: -</div>
<div id="tdeeText" class="mb-1">Calories allowed/day: -</div>
<div id="burnText" class="mb-1">Est. burn to lose: -</div>
<div id="estDaysText" class="mb-1">Est. days to goal: -</div>

  </div>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDCANiNTmv4bU7ayVyCD_Dwwf04QQ7XlVc",
      authDomain: "weight-tracker-01.firebaseapp.com",
      databaseURL: "https://weight-tracker-01-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "weight-tracker-01",
      storageBucket: "weight-tracker-01.appspot.com",
      messagingSenderId: "560173087855",
      appId: "1:560173087855:web:d6b591b55e6151ac7c619a",
      measurementId: "G-E4MRDK2VZE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const weightInput = document.getElementById("weightInput");
    const submitBtn = document.getElementById("submitWeight");
    const bmiText = document.getElementById("bmiText");
    const tdeeText = document.getElementById("tdeeText");
    const burnText = document.getElementById("burnText");
    const estDaysText = document.getElementById("estDaysText");

    let profile = {
      age: 15,
      height: 155,
      startWeight: 53,
      goalWeight: 48,
      gender: "male",
      activity: "moderate"
    };

    function updateCalculations(latestWeight) {
      const heightM = profile.height / 100;
      const bmi = (latestWeight / (heightM * heightM)).toFixed(1);
      bmiText.textContent = `BMI: ${bmi}`;

      const bmr = profile.gender === "male"
        ? 10 * latestWeight + 6.25 * profile.height - 5 * profile.age + 5
        : 10 * latestWeight + 6.25 * profile.height - 5 * profile.age - 161;

      const activityFactor = {
        sedentary: 1.2,
        light: 1.375,
        moderate: 1.55,
        active: 1.725
      };

      const tdee = Math.round(bmr * activityFactor[profile.activity]);
      tdeeText.textContent = `Calories allowed/day: ${tdee}`;
      burnText.textContent = `Est. burn to lose: ~500 cal/day`;

      const totalFatToLose = profile.startWeight - profile.goalWeight;
      const daysToGoal = Math.ceil((latestWeight - profile.goalWeight) / 0.5 * 7);
      estDaysText.textContent = `Est. days to goal: ${Math.max(daysToGoal, 0)}`;
    }

    function updateChartAndProgress(data) {
      const weights = Object.entries(data).sort((a, b) => a[0] - b[0]);
      const labels = weights.map((_, i) => `Entry ${i + 1}`);
      const values = weights.map(w => w[1]);

      if (window.myChart) window.myChart.destroy();
      window.myChart = new Chart(document.getElementById("weightChart"), {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Weight (kg)",
            data: values,
            borderColor: "dodgerblue",
            fill: false
          }]
        },
        options: { responsive: true }
      });

      const latestWeight = values[values.length - 1];
      const progress = Math.min(
        100,
        Math.max(0, ((profile.startWeight - latestWeight) / (profile.startWeight - profile.goalWeight)) * 100)
      );
      document.getElementById("progressBar").style.width = `${progress}%`;
      document.getElementById("progressText").textContent = `${progress.toFixed(1)}%`;

      updateCalculations(latestWeight);
    }

    function loadData() {
      get(child(ref(db), "weights")).then(snapshot => {
        if (snapshot.exists()) {
          updateChartAndProgress(snapshot.val());
        }
      });
    }

    submitBtn.onclick = () => {
      const weight = parseFloat(weightInput.value);
      if (!weight || weight <= 30 || weight > 300) return alert("Please enter valid weight.");
      const now = Date.now();
      set(ref(db, "weights/" + now), weight).then(loadData);
    };

    window.onload = () => {
      loadData();
    };
  </script></body>
</html>